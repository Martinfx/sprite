head     9.1;
branch   ;
access   ;
symbols  ds3100:9.1 sun3:9.1 sun4nw:9.1 symm:9.1 spur:9.1 Summer89:9.0 newlib:8.0 Summer88:6.0;
locks    ; strict;
comment  @ * @;


9.1
date     90.10.03.13.52.34;  author mgbaker;  state Exp;
branches ;
next     9.0;

9.0
date     89.09.12.14.51.35;  author douglis;  state Stable;
branches ;
next     8.2;

8.2
date     89.07.18.14.56.09;  author ouster;  state Exp;
branches ;
next     8.1;

8.1
date     89.04.03.18.36.27;  author rab;  state Exp;
branches ;
next     8.0;

8.0
date     88.11.11.18.04.05;  author douglis;  state Stable;
branches ;
next     6.0;

6.0
date     88.08.11.12.09.33;  author brent;  state Stable;
branches ;
next     5.1;

5.1
date     88.05.05.17.54.41;  author nelson;  state Exp;
branches ;
next     5.0;

5.0
date     87.08.31.19.03.17;  author nelson;  state Exp;
branches ;
next     ;


desc
@@


9.1
log
@Prototyping.
@
text
@/*
 * machMon.h --
 *
 *     Structures, constants and defines for access to the sun monitor.
 *     These are translated from the sun monitor header file "sunromvec.h".
 *
 * NOTE: The file keyboard.h in the monitor directory has all sorts of useful
 *       keyboard stuff defined.  I haven't attempted to translate that file
 *       because I don't need it.  If anyone wants to use it, be my guest.
 *
 * Copyright (C) 1985 Regents of the University of California
 * All rights reserved.
 *
 *
 * $Header: /sprite/src/kernel/mach/sun3.md/RCS/machMon.h,v 9.0 89/09/12 14:51:35 douglis Stable Locker: mgbaker $ SPRITE (Berkeley)
 */

#ifndef _MACHMON
#define _MACHMON

/*
 * The memory addresses for the PROM, and the EEPROM.
 * On the sun2 these addresses are actually 0x00EF??00
 * but only the bottom 24 bits are looked at so these still
 * work ok.
 */

#define EEPROM_BASE     0x0fe04000
#define PROM_BASE       0x0fef0000

/*
 * The table entry that describes a device.  It exists in the PROM; a
 * pointer to it is passed in MachMonBootParam.  It can be used to locate
 * PROM subroutines for opening, reading, and writing the device.
 *
 * When using this interface, only one device can be open at once.
 *
 * NOTE: I am not sure what arguments boot, open, close, and strategy take.  
 * What is here is just translated verbatim from the sun monitor code.  We 
 * should figure this out eventually if we need it.
 */

typedef struct {
	char	devName[2];		/* The name of the device */
	int	(*probe)();		/* probe() --> -1 or found controller 
					   number */
	int	(*boot)();		/* boot(bp) --> -1 or start address */
	int	(*open)();		/* open(iobp) --> -1 or 0 */
	int	(*close)();		/* close(iobp) --> -1 or 0 */
	int	(*strategy)();		/* strategy(iobp,rw) --> -1 or 0 */
	char	*desc;			/* Printable string describing dev */
} MachMonBootTable;

/*
 * Structure set up by the boot command to pass arguments to the program that
 * is booted.
 */

typedef struct {
	char		*argPtr[8];	/* String arguments */
	char		strings[100];	/* String table for string arguments */
	char		devName[2];	/* Device name */
	int		ctlrNum;	/* Controller number */
	int		unitNum;	/* Unit number */
	int		partNum;	/* Partition/file number */
	char		*fileName;	/* File name, points into strings */
	MachMonBootTable   *bootTable;	/* Points to table entry for device */
} MachMonBootParam;

/*
 * Here is the structure of the vector table which is at the front of the boot
 * rom.  The functions defined in here are explained below.
 *
 * NOTE: This struct has references to the structures keybuf and globram which
 *       I have not translated.  If anyone needs to use these they should
 *       translate these structs into Sprite format.
 */

typedef struct {
	char		*initSp;		/* Initial system stack ptr  
						 * for hardware */
	int		(*startMon)();		/* Initial PC for hardware */

	int		*diagberr;		/* Bus err handler for diags */

	/* 
	 * Monitor and hardware revision and identification
	 */

	MachMonBootParam **bootParam;		/* Info for bootstrapped pgm */
 	unsigned	*memorySize;		/* Usable memory in bytes */

	/* 
	 * Single-character input and output 
	 */

	unsigned char	(*getChar)();		/* Get char from input source */
	int		(*putChar)();		/* Put char to output sink */
	int		(*mayGet)();		/* Maybe get char, or -1 */
	int		(*mayPut)();		/* Maybe put char, or -1 */
	unsigned char	*echo;			/* Should getchar echo? */
	unsigned char	*inSource;		/* Input source selector */
	unsigned char	*outSink;		/* Output sink selector */

	/* 
	 * Keyboard input (scanned by monitor nmi routine) 
	 */

	int		(*getKey)();		/* Get next key if one exists */
	int		(*initGetKey)();	/* Initialize get key */
	unsigned int	*translation;		/* Kbd translation selector 
						   (see keyboard.h in sun 
						    monitor code) */
	unsigned char	*keyBid;		/* Keyboard ID byte */
	int		*screen_x;		/* V2: Screen x pos (R/O) */
	int		*screen_y;		/* V2: Screen y pos (R/O) */
	struct keybuf	*keyBuf;		/* Up/down keycode buffer */

	/*
	 * Monitor revision level.
	 */

	char		*monId;

	/* 
	 * Frame buffer output and terminal emulation 
	 */

	int		(*fbWriteChar)();	/* Write a character to FB */
	int		*fbAddr;		/* Address of frame buffer */
	char		**font;			/* Font table for FB */
	int		(*fbWriteStr)();	/* Quickly write string to FB */

	/* 
	 * Reboot interface routine -- resets and reboots system.  No return. 
	 */

	int		(*reBoot)();		/* e.g. reBoot("xy()vmunix") */

	/* 
	 * Line input and parsing 
	 */

	unsigned char	*lineBuf;		/* The line input buffer */
	unsigned char	**linePtr;		/* Cur pointer into linebuf */
	int		*lineSize;		/* length of line in linebuf */
	int		(*getLine)();		/* Get line from user */
	unsigned char	(*getNextChar)();	/* Get next char from linebuf */
	unsigned char	(*peekNextChar)();	/* Peek at next char */
	int		*fbThere;		/* =1 if frame buffer there */
	int		(*getNum)();		/* Grab hex num from line */

	/* 
	 * Print formatted output to current output sink 
	 */

	int		(*printf)();		/* Similar to "Kernel printf" */
	int		(*printHex)();		/* Format N digits in hex */

	/*
	 * Led stuff 
	 */

	unsigned char	*leds;			/* RAM copy of LED register */
	int		(*setLeds)();		/* Sets LED's and RAM copy */

	/* 
	 * Non-maskable interrupt  (nmi) information
	 */ 

	int		(*nmiAddr)();		/* Addr for level 7 vector */
	int		(*abortEntry)();	/* Entry for keyboard abort */
	int		*nmiClock;		/* Counts up in msec */

	/*
	 * Frame buffer type: see <sun/fbio.h>
	 */

	int		*fbType;

	/* 
	 * Assorted other things 
	 */

	unsigned	romvecVersion;		/* Version # of Romvec */ 
	struct globram  *globRam;		/* monitor global variables */
	Address		kbdZscc;		/* Addr of keyboard in use */

	int		*keyrInit;		/* ms before kbd repeat */
	unsigned char	*keyrTick; 		/* ms between repetitions */
	unsigned	*memoryAvail;		/* V1: Main mem usable size */
	long		*resetAddr;		/* where to jump on a reset */
	long		*resetMap;		/* pgmap entry for resetaddr */
						/* Really struct pgmapent *  */
	int		(*exitToMon)();		/* Exit from user program */
	unsigned char	**memorybitmap;		/* V1: &{0 or &bits} */
	void		(*setcxsegmap)();	/* Set seg in any context */
	void		(**vector_cmd)();	/* V2: Handler for 'v' cmd */
	int		dummy1z;
	int		dummy2z;
	int		dummy3z;
	int		dummy4z;
} MachMonRomVector;

/*
 * Functions defined in the vector:
 *
 *
 * getChar -- Return the next character from the input source
 *
 *     unsigned char getChar()
 *
 * putChar -- Write the given character to the output source.
 *
 *     void putChar(ch)
 *	   char ch;	
 *
 * mayGet -- Maybe get a character from the current input source.  Return -1 
 *           if don't return a character.
 *
 * 	int mayGet()
 *	
 * mayPut -- Maybe put a character to the current output source.   Return -1
 *           if no character output.
 *
 *	int  mayPut(ch)
 *	    char ch;
 *
 * getKey -- Returns a key code (if up/down codes being returned),
 * 	     a byte of ASCII (if that's requested),
 * 	     NOKEY (if no key has been hit).
 *
 *	int getKey()
 *	
 * initGetKey --  Initialize things for get key.
 *
 *	void initGetKey()
 *
 * fbWriteChar -- Write a character to the frame buffer
 *
 *	void fwritechar(ch)
 *	    unsigned char ch;
 *
 * fbWriteStr -- Write a string to the frame buffer.
 *
 *   	void fwritestr(addr,len)
 *  	    register unsigned char *addr;	/ * String to be written * /
 *  	    register short len;			/ * Length of string * /
 *
 * getLine -- read the next input line into a global buffer
 *
 *	getline(echop)
 *          int echop;	/ * 1 if should echo input, 0 if not * /
 *
 * getNextChar -- return the next character from the global line buffer.
 *
 *	unsigned char getNextChar()
 *
 * peekNextChar -- look at the next character in the global line buffer.
 *
 *	unsigned char peekNextChar()
 *
 * getNum -- Grab hex num from the global line buffer.
 *
 *	int getNum()
 *
 * printf -- Scaled down version of C library printf.  Only %d, %x, %s, and %c
 * 	     are recognized.
 *
 * printhex -- prints rightmost <digs> hex digits of <val>
 *
 *      printhex(val,digs)
 *          register int val;
 *     	    register int digs;
 *
 * abortEntry -- Entry for keyboard abort.
 *
 *     abortEntry()
 */

/*
 * Where the rom vector is defined.
 */

#define	romVectorPtr	((MachMonRomVector *) PROM_BASE)

/*
 * Functions and defines to access the monitor.
 */

#define Mach_MonPrintf (romVectorPtr->printf)

extern void Mach_MonPutChar _ARGS_((int ch));
extern int Mach_MonMayPut _ARGS_((int ch));
extern void Mach_MonAbort _ARGS_((void));
extern void Mach_MonReboot _ARGS_((char *rebootString));
extern void Mach_MonStartNmi _ARGS_((void));
extern void Mach_MonStopNmi _ARGS_((void));

extern  void    Mach_MonTrap _ARGS_((Address address_to_trap_to));

/*
 * These routines no longer work correctly with new virtual memory.
 */

#define Mach_MonGetChar (romVectorPtr->getChar)
#define Mach_MonGetLine (romVectorPtr->getLine)
#define Mach_MonGetNextChar (romVectorPtr->getNextChar)
#define Mach_MonPeekNextChar (romVectorPtr->peekNextChar)


#endif /* _MACHMON */
@


9.0
log
@Changing version numbers.
@
text
@d15 1
a15 1
 * $Header: /sprite/src/kernel/mach/sun3.md/RCS/machMon.h,v 8.2 89/07/18 14:56:09 ouster Exp Locker: douglis $ SPRITE (Berkeley)
a291 4
extern	void 	Mach_MonPutChar ();
extern	int  	Mach_MonMayPut();
extern	void	Mach_MonAbort();
extern	void	Mach_MonReboot();
d293 9
a310 4

extern	void	Mach_MonTrap();
extern	void	Mach_MonStopNmi();
extern	void	Mach_MonStartNmi();
@


8.2
log
@Removed reference to devZilog.h
@
text
@d15 1
a15 1
 * $Header: /sprite/src/kernel/mach/sun3.md/RCS/machMon.h,v 8.1 89/04/03 18:36:27 rab Exp Locker: ouster $ SPRITE (Berkeley)
@


8.1
log
@*** empty log message ***
@
text
@d15 1
a15 1
 * $Header: /sprite/src/kernel/mach/sun2.md/RCS/machMon.h,v 8.0 88/11/11 18:04:05 douglis Stable Locker: rab $ SPRITE (Berkeley)
a20 2
#include "devZilog.h"

d187 1
a187 1
	Dev_ZilogDevice *kbdZscc;		/* Addr of keyboard in use */
@


8.0
log
@Changing version numbers.
@
text
@d15 1
a15 1
 * $Header: /sprite/src/kernel/mach/sun2.md/RCS/machMon.h,v 6.0 88/08/11 12:09:33 brent Stable Locker: douglis $ SPRITE (Berkeley)
d24 10
d284 1
a284 2
 * Where the rom vector is defined.  Note that on a Sun-2 the address is
 * 0xef0000.  This is ok because only the low order 24-bits will be looked at.
d287 1
a287 1
#define	romVectorPtr	((MachMonRomVector *)0xFEF0000)
d313 1
a313 1
#endif _MACHMON
@


6.0
log
@Changing version numbers.
@
text
@d15 1
a15 1
 * $Header: machMon.h,v 5.1 88/05/05 17:54:41 nelson Exp $ SPRITE (Berkeley)
@


5.1
log
@Handles move of functionality from sys to mach.
@
text
@d15 1
a15 1
 * $Header: machMon.h,v 5.0 87/08/31 19:03:17 nelson Exp $ SPRITE (Berkeley)
@


5.0
log
@*** empty log message ***
@
text
@d2 1
a2 1
 * sunMon.h --
d15 1
a15 1
 * $Header: sunMon.h,v 5.0 87/08/11 10:50:29 sprite Exp $ SPRITE (Berkeley)
d18 2
a19 2
#ifndef _SUNMON
#define _SUNMON
d25 1
a25 1
 * pointer to it is passed in Mon_BootParam.  It can be used to locate
d44 1
a44 1
} Mon_BootTable;
d59 2
a60 2
	Mon_BootTable   *bootTable;	/* Points to table entry for device */
} Mon_BootParam;
d82 1
a82 1
	Mon_BootParam	**bootParam;		/* Info for bootstrapped pgm */
d195 1
a195 1
} Mon_RomVector;
d278 1
a278 1
#define	romVectorPtr	((Mon_RomVector *)0xFEF0000)
d284 5
a288 5
#define Mon_Printf (romVectorPtr->printf)
extern	void 	Mon_PutChar ();
extern	int  	Mon_MayPut();
extern	void	Mon_Abort();
extern	void	Mon_Reboot();
d294 4
a297 4
#define Mon_GetChar (romVectorPtr->getChar)
#define Mon_GetLine (romVectorPtr->getLine)
#define Mon_GetNextChar (romVectorPtr->getNextChar)
#define Mon_PeekNextChar (romVectorPtr->peekNextChar)
d300 3
a302 3
extern	void	Mon_Trap();
extern	void	Mon_StopNmi();
extern	void	Mon_StartNmi();
d304 1
a304 1
#endif _SUNMON
@
