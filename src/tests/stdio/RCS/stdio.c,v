head     1.12;
branch   ;
access   ;
symbols  sprited:1.12.1;
locks    ; strict;
comment  @ * @;


1.12
date     91.12.12.13.43.34;  author shirriff;  state Exp;
branches 1.12.1.1;
next     1.11;

1.11
date     89.03.16.11.54.28;  author ouster;  state Exp;
branches ;
next     1.10;

1.10
date     88.12.15.09.50.57;  author ouster;  state Exp;
branches ;
next     1.9;

1.9
date     88.10.23.15.39.22;  author ouster;  state Exp;
branches ;
next     1.8;

1.8
date     88.10.01.10.17.12;  author ouster;  state Exp;
branches ;
next     1.7;

1.7
date     88.07.21.10.57.09;  author ouster;  state Exp;
branches ;
next     1.6;

1.6
date     88.07.21.09.35.31;  author ouster;  state Exp;
branches ;
next     1.5;

1.5
date     88.07.20.18.11.18;  author ouster;  state Exp;
branches ;
next     1.4;

1.4
date     88.06.13.09.59.55;  author ouster;  state Exp;
branches ;
next     1.3;

1.3
date     88.06.10.10.19.52;  author ouster;  state Exp;
branches ;
next     1.2;

1.2
date     88.06.06.17.46.50;  author ouster;  state Exp;
branches ;
next     1.1;

1.1
date     88.06.06.08.43.33;  author ouster;  state Exp;
branches ;
next     ;

1.12.1.1
date     91.12.12.22.44.40;  author kupfer;  state Exp;
branches ;
next     ;


desc
@@


1.12
log
@Support for different byte orders.  (Mike checking in for Ken.)
@
text
@/* 
 * stdio.c --
 *
 *	This file contains a program that exercises the stdio
 *	library facilities.  Invoke it with no parameters;  it
 *	will print messages on stderr for any problems it detects
 *	with the stdio procedures.
 *
 * Copyright 1988 Regents of the University of California
 * Permission to use, copy, modify, and distribute this
 * software and its documentation for any purpose and without
 * fee is hereby granted, provided that the above copyright
 * notice appear in all copies.  The University of California
 * makes no representations about the suitability of this
 * software for any purpose.  It is provided "as is" without
 * express or implied warranty.
 */

#ifndef lint
static char rcsid[] = "$Header: /sprite/src/tests/stdio/RCS/stdio.c,v 1.11 89/03/16 11:54:28 ouster Exp $ SPRITE (Berkeley)";
#endif not lint

#include <stdio.h>
#include <string.h>
#include <sys/file.h>
#include <sys/wait.h>
#include <signal.h>
#include <varargs.h>

#ifdef sun3
#define BIGENDIAN
#endif
#ifdef sun4
#define BIGENDIAN
#endif
#ifdef ds3100
#define LITTLEENDIAN
#endif

#if 1
#define error(string) \
    fprintf(stderr, string); \
    exit(1);
#else
#define error(string) \
    fprintf(stderr, string);
#endif

/*
 *----------------------------------------------------------------------
 *
 * CheckFile --
 *
 *	Utility procedure to make sure that a given file contains a
 *	given value.  Aborts with error if it doesn't.
 *
 * Results:
 *	None.
 *
 * Side effects:
 *	None.
 *
 *----------------------------------------------------------------------
 */

void
CheckFile(name, value, errMsg)
    char *name;			/* Name of file to read. */
    char *value;		/* Should match contents of file. */
    char *errMsg;		/* Error message if there's a mismatch. */
{
    char buf[BUFSIZ];
    int count, id;

    id = open(name, O_RDONLY, 0);
    if (id < 0) {
	error(errMsg);
    }
    count = read(id, buf, 1000);
    if ((count == -1) || (count == 1000)) {
	error(errMsg);
    }
    buf[count] = 0;
    if (strcmp(buf, value) != 0) {
	error(errMsg);
    }
    close(id);
}

/*
 *----------------------------------------------------------------------
 *
 * TsCheck --
 *
 *	Procedure for comparing two special-purpose structures, for
 *	testing fread and fwrite.
 *
 * Results:
 *	None.
 *
 * Side effects:
 *	Aborts if ts1 and ts2 aren't equal.
 *
 *----------------------------------------------------------------------
 */

typedef struct {
    int x;
    char c[6];
    short y;
} testStruct;

void
TsCheck(ts1, ts2, msg)
    testStruct *ts1, *ts2;		/* Two structures to compare for
					 * equality. */
    char *msg;				/* Message to print if mismatch. */
{
    int i;
    if ((ts1->x != ts2->x) || (ts1->y != ts2->y)) {
	error(msg);
    }
    for (i = 0; i < 6; i++) {
	if (ts1->c[i] != ts2->c[i]) {
	    error(msg);
	}
    }
}

/*
 *----------------------------------------------------------------------
 *
 * CheckNext --
 *
 *	Procedure for testing fprintf:  reads back from a file and
 *	makes sure what was printed had the right length and content..
 *
 * Results:
 *	None.
 *
 * Side effects:
 *	Aborts if the contents of the file's next line don't match string
 *	and length.
 *
 *----------------------------------------------------------------------
 */

void
CheckNext(f, string, length, msg)
    FILE *f;			/* File from which to read a line. */
    char *string;		/* This should match exactly the line. */
    int length;			/* The line should be this long. */
    char *msg;			/* Error message to print if there's
				 * a problem. */
{
    char buffer[500];
    if (fgets(buffer, 500, f) == NULL) {
	error(msg);
    }
    if (strlen(buffer) != length) {
	error(msg);
    }
    if (strcmp(buffer, string) != 0) {
	error(msg);
    }
}

/*
 *----------------------------------------------------------------------
 *
 * CheckFp --
 *
 *	This procedure is used to check floating-point scanning.  It
 *	prints the numbers, so as to do an approximate check, rather than
 *	an exact one (fp conversion isn't exact, after all)..
 *
 * Results:
 *	None.
 *
 * Side effects:
 *	Aborts if the printed version of f1-f4 don't match string.
 *
 *----------------------------------------------------------------------
 */

void
CheckFp(count1, count2, f1, f2, f3, f4, string, msg)
    int count1, count2;		/* These two counts better match. */
    double f1, f2, f3, f4;	/* Four numbers; when printed in %e format,
				 * they better match string. */
    char *string;		/* Desired values of numbers. */
    char *msg;			/* Error message. */
{
    char printed[200];

    if (count1 != count2) {
	error(msg);
    }
    sprintf(printed, "%e %e %e %e", f1, f2, f3, f4);
    if (strcmp(printed, string) != 0) {
	printf("CheckFP: %s vs. %s\n", printed, string);
	error(msg);
    }
}

/*
 *----------------------------------------------------------------------
 *
 * CheckString --
 *
 *	Utility procedure for checking sscanf on strings.  Scans input
 *	according to format, into four result strings, and compares them
 *	against s1-s4.
 *
 * Results:
 *	None.
 *
 * Side effects:
 *	Aborts if there's a mismatch.
 *
 *----------------------------------------------------------------------
 */


void
CheckString(input, format, count, s1, s2, s3, s4, msg)
    char *format;		/* Format to use for scanning. */
    char *input;		/* Input string to scan. */
    int count;			/* Expected return value from sscanf. */
    char *s1, *s2, *s3, *s4;	/* Scanned strings should match this. */
    char *msg;			/* Message to print on error. */
{
    char c1[100], c2[100], c3[100], c4[100];
    int result, i;

    for (i = 0; i < 100; i++) {
	char c;
	if (i < 5) {
	    c = 'X';
	} else {
	    c = 0;
	}
	c1[i] = c2[i] = c3[i] = c4[i] = c;
    }
    result = sscanf(input, format, c1, c2, c3, c4);
    if ((result != count) || (strcmp(c1, s1) != 0) || (strcmp(c2, s2) != 0)
	    || (strcmp(c3, s3) != 0) || (strcmp(c4, s4) != 0)) {
	error(msg);
    }
}

/*
 *----------------------------------------------------------------------
 *
 * CheckVprintf --
 *
 *	This procedure is used to check vprintf:  it just packages its
 *	arguments and calls vprintf.
 *
 * Results:
 *	Whatever vprintf returns.
 *
 * Side effects:
 *	None.
 *
 *----------------------------------------------------------------------
 */

int
CheckVprintf(va_alist)
    va_dcl		/* Format string followed by one or more arguments
			 * to printf. */
{
    char *format;
    va_list args;

    va_start(args);
    format = va_arg(args, char *);
    return vprintf(format, args);
}

/*
 *----------------------------------------------------------------------
 *
 * CheckVsprintf --
 *
 *	This procedure is used to check vsprintf:  it just packages its
 *	arguments and calls vsprintf.
 *
 * Results:
 *	Whatever vsprintf returns.
 *
 * Side effects:
 *	None.
 *
 *----------------------------------------------------------------------
 */

char *
CheckVsprintf(va_alist)
    va_dcl		/* Format string followed by one or more arguments
			 * to printf. */
{
    char *string;
    char *format;
    va_list args;

    va_start(args);
    string = va_arg(args, char *);
    format = va_arg(args, char *);
    return vsprintf(string, format, args);
}

/*
 *----------------------------------------------------------------------
 *
 * main --
 *
 *	Main program for stdio testing.
 *
 * Results:
 *	None.
 *
 * Side effects:
 *	Runs a whole bunch of little tests on the stdio procedures,
 *	and aborts with an error message if any unexpected behavior
 *	is observed.  Exits with 0 status and no output if all goes
 *	well.
 *
 *----------------------------------------------------------------------
 */

main()
{
    FILE *f1, *f2, *f3;
    char buf[BUFSIZ], c;
    int i, fd, fd2, pid, length, count;
    testStruct tsArray1[20], tsArray2[20]; 
    union wait status;
    int d1, d2, d3, d4;
    float fp1, fp2, fp3, fp4;
    double dbl1, dbl2, dbl3, dbl4;
    short s1, s2, s3, sa1[4], sa2[4];

    /*
     * putc, fputc, fputs
     */

    f1 = fopen("test", "w");
    if (f1 == NULL) {
	error("putc error 1\n");
    }
    if (putc('a', f1) == EOF) {
	error("putc error 2\n");
    }
    if (putc('b', f1) == EOF) {
	error("putc error 3\n");
    }
    if (fputc('c', f1) != 'c') {
	error("putc error 4\n");
    }
    if (fputc('\n', f1) != '\n') {
	error("putc error 5\n");
    }
    if (fputs("This is the second line.\n", f1) == EOF) {
	error("putc error 6\n");
    }
    i = fclose(f1);
    if (i != 0) {
	error("putc error 7\n");
    }
    CheckFile("test", "abc\nThis is the second line.\n", "putc error 8\n");
    f1 = fopen("test2", "w");
    if (fputc(0377, f1) != 0377) {
	error("putc error 9\n");
    }
    if (putc(0377, f1) != 0377) {
	error("putc error 10\n");
    }
    if (fputc(-1, f1) != 0377) {
	error("putc error 11\n");
    }
    if (putc(-1, f1) != 0377) {
	error("putc error 12\n");
    }
    fclose(f1);
    f1 = fopen("test", "r");
    if (putc('a', f1) != EOF) {
	error("putc error 13\n");
    }
    if (fputc('a', f1) != EOF) {
	error("putc error 14\n");
    }
    if (fputs("abcde", f1) != EOF) {
	error("putc error 15\n");
    }

    /*
     * getc, fgetc, fgets
     */

    c = getc(f1);
    if (c != 'a') {
	error("getc error 1\n");
    }
    buf[4] = 'Z';
    if (fgets(buf, 100, f1) == NULL) {
	error("getc error 2\n");
    }
    if (strcmp(buf, "bc\n") != 0) {
	error("getc error 3\n");
    }
    if (buf[4] != 'Z') {
	error("getc error 4\n");
    }
    c = fgetc(f1);
    if (c != 'T') {
	error("getc error 5\n");
    }
    buf[10] = 'X';
    if (fgets(buf, 10, f1) == NULL) {
	error("getc error 6\n");
    }
    if (strcmp(buf, "his is th") != 0) {
	error("getc error 7\n");
    }
    if (buf[10] != 'X') {
	error("getc error 8\n");
    }
    buf[16] = 0377;
    if (fgets(buf, 100, f1) == NULL) {
	error("getc error 9\n");
    }
    if (strcmp(buf, "e second line.\n") != 0) {
	error("getc error 8\n");
    }
    if (buf[16] != -1) {
	error("getc error 9\n");
    }
    if (getc(f1) != EOF) {
	error("getc error 10\n");
    }
    if (fgetc(f1) != EOF) {
	error("getc error 11\n");
    }
    if (fgets(buf, 1000, f1) != NULL) {
	error("getc error 12\n");
    }
    i = fclose(f1);
    if (i != 0) {
	error("getc error 13\n");
    }
    f1 = fopen("test", "w");
    if (f1 == NULL) {
	error("getc error 14\n");
    }
    if (getc(f1) != EOF) {
	error("getc error 15\n");
    }
    fputs("Line with no return", f1);
    fclose(f1);
    f1 = fopen("test", "r");
    if (f1 == NULL) {
	error("getc error 16\n");
    }
    if (fgets(buf, 1000, f1) != NULL) {
	error("getc error 17\n");
    }
    fclose(f1);

    /*
     * putw, getw
     */

    f1 = fopen("test", "w");
    if (f1 == NULL) {
	error("putw error 1\n");
    }
    putc('a', f1);
    if (putw(0x010203ff, f1) != 0) {
	error("putw error 2\n");
    }
    if (putw(0x04050607, f1) != 0) {
	error("putw error 3\n");
    }
    if (getw(f1) != EOF) {
	error("putw error 4\n");
    }
    fclose(f1);
#ifndef LITTLEENDIAN
    CheckFile("test", "a\1\2\3\377\4\5\6\7", "putw error 5(B)\n");
#endif
#ifndef BIGENDIAN
    CheckFile("test", "a\377\3\2\1\7\6\5\4", "putw error 5(L)\n");
#endif
    f1 = fopen("test", "r");
    if (f1 == NULL) {
	error("putw error 6\n");
    }
    (void) getc(f1);
    d1 = getw(f1);
    if (feof(f1)) {
	error("putw error 7\n");
    }
    d2 = getw(f1);
    if (feof(f1)) {
	error("putw error 8\n");
    }
    d3 = getw(f1);
    if (!feof(f1)) {
	error("putw error 9\n");
    }
    if ((d1 != 0x010203ff) || (d2 != 0x04050607) || (d3 != EOF)) {
	error("putw error 10\n");
    }
    if (putw(1, f1) != EOF) {
	error("putw error 11\n");
    }
    fclose(f1);

    /*
     * fileno
     */

    if (fileno(stdin) != 0) {
	error("fileno error 1\n");
    }
    if (fileno(stdout) != 1) {
	error("fileno error 2\n");
    }
    if (fileno(stderr) != 2) {
	error("fileno error 3\n");
    }
    fd = dup(1);
    fclose(stdout);
    f1 = fopen("test", "w");
    if (fileno(f1) != 1) {
	error("fileno error 4\n");
    }

    /*
     * putchar, puts
     */

    if (putchar('x') == EOF) {
	error("putchar error 1\n");
    }
    if (puts(" more on this line.") == EOF) {
	error("putchar error 2\n");
    }
    if (puts("A second line.") == EOF) {
	error("putchar error 3\n");
    }
    fclose(f1);
    if (putchar('x') != EOF) {
	error("putchar error 4\n");
    }
    if (puts("More junk.") != EOF) {
	error("putchar error 5\n");
    }
    dup2(fd, 1);
    (void) fdopen(1, "w");
    CheckFile("test", "x more on this line.\nA second line.\n",
	    "putchar error 6\n");
    close(fd);

    /*
     * getchar, gets
     */

    fd = dup(0);
    fclose(stdin);
    f1 = fopen("test", "r");
    if (fileno(f1) != 0) {
	error("getchar error 1\n");
    }
    if (getchar() != 'x') {
	error("getchar error 2\n");
    }
    if (getchar() != ' ') {
	error("getchar error 3\n");
    }
    if (gets(buf) != buf) {
	error("gets error 1\n");
    }
    if (strcmp(buf, "more on this line.") != 0) {
	error("gets error 2\n");
    }
    if (gets(buf) != buf) {
	error("gets error 3\n");
    }
    if (strcmp(buf, "A second line.") != 0) {
	error("gets error 4\n");
    }
    if (gets(buf) != NULL) {
	error("gets error 5\n");
    }
    if (getchar() != EOF) {
	error("getchar error 4\n");
    }
    dup2(fd, 0);
    (void) fdopen(0, "r");
    close(fd);

    /*
     * fwrite, fread
     */

    for (i = 0; i < 10; i++) {
	int j;

	tsArray1[i].x = 0x52ff6984 + i;
	tsArray1[i].y = 47+i;
	for (j = 0; j < 6; j++) {
	    tsArray1[i].c[j] = 'A' + 2*i + j;
	}
    }
    f1 = fopen("test", "w");
    f2 = fopen("test", "r");
    if (f1 == NULL) {
	error("fwrite error 1\n");
    }
    if (f2 == NULL) {
	error("fread error 1\n");
    }
    if (fwrite(tsArray1, sizeof(testStruct), 10, f1) != 10) {
	error("fwrite error 2\n");
    }
    if (fwrite(&tsArray1[3], sizeof(testStruct), 5, f1) != 5) {
	error("fwrite error 3\n");
    }
    if (fwrite(tsArray1, sizeof(testStruct), 1, f1) != 1) {
	error("fwrite error 4\n");
    }
    if (fwrite(tsArray1, sizeof(testStruct), 1, f2) != 0) {
	error("fwrite error 5\n");
    }
    fclose(f1);
    if (fread(tsArray2, sizeof(testStruct), 2, f2) != 2) {
	error("fread error 2\n");
    }
    TsCheck(&tsArray1[0], &tsArray2[0], "fread error 3\n");
    TsCheck(&tsArray1[1], &tsArray2[1], "fread error 4\n");
    if (fread(tsArray2, sizeof(testStruct), 10, f2) != 10) {
	error("fread error 5\n");
    }
    for (i = 0; i < 10; i++) {
	if (i >= 8) {
	    TsCheck(&tsArray1[i-5], &tsArray2[i], "fread error 6\n");
	} else {
	    TsCheck(&tsArray1[i+2], &tsArray2[i], "fread error 7\n");
	}
    }
    if (fread(tsArray2, sizeof(testStruct), 1, f2) != 1) {
	error("fread error 8\n");
    }
    TsCheck(&tsArray1[5], &tsArray2[0], "fread error 9\n");
    if (fread(tsArray2, sizeof(testStruct), 5, f2) != 3) {
	error("fread error 10\n");
    }
    TsCheck(&tsArray1[6], &tsArray2[0], "fread error 11\n");
    TsCheck(&tsArray1[7], &tsArray2[1], "fread error 12\n");
    TsCheck(&tsArray1[0], &tsArray2[2], "fread error 13\n");
    if (fread(tsArray2, sizeof(testStruct), 1, f2) != 0) {
	error("fread error 14\n");
    }
    fclose(f2);

    /*
     * fseek, rewind, and ftell
     */

    f1 = fopen("test", "w+");
    if (f1 == NULL) {
	error("fseek error 1\n");
    }
    fputs("abcdefghijklmnopqrstuvwxyz", f1);
    if (ftell(f1) != 26) {
	error("fseek error 2\n");
    }
    fseek(f1, 2, SEEK_SET);
    putc('1', f1);
    if (ftell(f1) != 3) {
	error("fseek error 3\n");
    }
    fseek(f1, 4, SEEK_CUR);
    putc('2', f1);
    if (ftell(f1) != 8) {
	error("fseek error 4\n");
    }
    fseek(f1, -1, SEEK_END);
    fputs("345", f1);
    if (ftell(f1) != 28) {
	error("fseek error 5\n");
    }
    fflush(f1);
    CheckFile("test", "ab1defg2ijklmnopqrstuvwxy345", "fseek error 6\n");
    fseek(f1, 1, SEEK_SET);
    if (getc(f1) != 'b') {
	error("fseek error 7\n");
    }
    if (ftell(f1) != 2) {
	error("fseek error 8\n");
    }
    fseek(f1, -2, SEEK_END);
    if (ftell(f1) != 26) {
	error("fseek error 9\n");
    }
    if (getc(f1) != '4') {
	error("fseek error 10\n");
    }
    if (getc(f1) != '5') {
	error("fseek error 11\n");
    }
    if (getc(f1) != EOF) {
	error("fseek error 12\n");
    }
    if (fseek(f1, -1, SEEK_CUR) != 0) {
	error("fseek error 13\n");
    }
    if (getc(f1) != '5') {
	error("fseek error 14\n");
    }
    rewind(f1);
    if (getc(f1) != 'a') {
	error("fseek error 15\n");
    }
    fclose(f1);
    /*
     * Check fseeks across buffer boundaries and with both read-only
     * streams and read-write streams.
     */
    f1 = fopen("test", "w");
    if (f1 == NULL) {
	error("fseek error 16\n");
    }
    for (i = 0; i <= 3 * BUFSIZ - 1; i++) {
	putc(i&0xff, f1);
    }
    fclose(f1);
    f1 = fopen("test", "r");
    if (f1 == NULL) {
	error("fseek error 16a\n");
    }
    if (getc(f1) != 0) {
	error("fseek error 17\n");
    }
    fseek(f1, 0, SEEK_SET);
    if (getc(f1) != 0) {
	error("fseek error 17a\n");
    }
    fseek(f1, BUFSIZ-1, SEEK_SET);
    if (getc(f1) != ((BUFSIZ-1) & 0xff)) {
	error("fseek error 18\n");
    }
    fseek(f1, BUFSIZ+1, SEEK_SET);
    if (getc(f1) != ((BUFSIZ+1) & 0xff)) {
	error("fseek error 19\n");
    }
    if (getc(f1) != ((BUFSIZ+2) & 0xff)) {
	error("fseek error 20\n");
    }
    fseek(f1, 3 * BUFSIZ - 2, SEEK_SET);
    if (getc(f1) != ((3 * BUFSIZ - 2) & 0xff)) {
	error("fseek error 21\n");
    }
    if (getc(f1) != ((3 * BUFSIZ - 1) & 0xff)) {
	error("fseek error 22\n");
    }
    if (getc(f1) != EOF) {
	error("fseek error 23\n");
    }
    fclose(f1);
    f1 = fopen("test", "r+");
    if (f1 == NULL) {
	error("fseek error 24\n");
    }
    for (i = 0; i < 3 * BUFSIZ - 1; i++) {
	putc(i&0xff, f1);
    }
    fseek(f1, 0, SEEK_SET);
    if (getc(f1) != 0) {
	error("fseek error 25\n");
    }
    fseek(f1, BUFSIZ-1, SEEK_SET);
    if (getc(f1) != ((BUFSIZ-1) & 0xff)) {
	error("fseek error 26\n");
    }
    fseek(f1, BUFSIZ+1, SEEK_SET);
    if (getc(f1) != ((BUFSIZ+1) & 0xff)) {
	error("fseek error 27\n");
    }
    if (getc(f1) != ((BUFSIZ+2) & 0xff)) {
	error("fseek error 28\n");
    }
    fseek(f1, 3 * BUFSIZ - 2, SEEK_SET);
    if (getc(f1) != ((3 * BUFSIZ - 2) & 0xff)) {
	error("fseek error 29\n");
    }
    if (getc(f1) != ((3 * BUFSIZ - 1) & 0xff)) {
	error("fseek error 30\n");
    }
    if (getc(f1) != EOF) {
	error("fseek error 31\n");
    }
    fclose(f1);
	
    

    /*
     * Buffering: setbuf, setbuffer, setlinebuf, setvbuf, fflush
     */

    f1 = fopen("test", "w");
    if (f1 == NULL) {
	error("setvbuf error 1\n");
    }
    if (setvbuf(f1, buf, _IOFBF, 10) != 0) {
	error("setvbuf error 2\n");
    }
    fputs("abcd\nefgh", f1);
    if (strncmp(buf, "abcd\nefgh", 9) != 0) {
	error("setvbuf error 3\n");
    }
    CheckFile("test", "", "setvbuf error 4\n");
    putc('i', f1);
    CheckFile("test", "abcd\nefghi", "setvbuf error 5\n");
    fseek(f1, 0, SEEK_SET);
    if (setvbuf(f1, 0, _IOLBF, 100) != 0) {
	error("setvbuf error 6\n");
    }
    buf[0] = buf[1] = 0;
    fputs("123456\n7890", f1);
    if (buf[0] != 0) {
	error("setvbuf error 7\n");
    }
    CheckFile("test", "123456\nghi", "setvbuf error 8\n");
    if (fflush(f1) != 0) {
	error("setvbuf error 9\n");
    }
    CheckFile("test", "123456\n7890", "setvbuf error 10\n");
    putc('X', f1);
    CheckFile("test", "123456\n7890", "setvbuf error 11\n");
    if (setvbuf(f1, 0, _IONBF, BUFSIZ) != 0) {
	error("setvbuf error 11\n");
    }
    CheckFile("test", "123456\n7890X", "setvbuf error 12\n");
    putc('Y', f1);
    CheckFile("test", "123456\n7890XY", "setvbuf error 13\n");
    if (setvbuf(f1, 0, _IOFBF, 1) != 0) {
	error("setvbuf error 14\n");
    }
    putc('Z', f1);
    CheckFile("test", "123456\n7890XYZ", "setvbuf error 15\n");
    setbuf(f1, buf);
    for (i = 0; i < BUFSIZ-1; i++) {
	putc(i&0xff, f1);
    }
    if ((buf[0] != 0) || ((buf[BUFSIZ-2] & 0xff) != ((BUFSIZ-2)&0xff))) {
	error("setbuf error 1\n");
    }
    CheckFile("test", "123456\n7890XYZ", "setbuf error 2\n");
    f2 = fopen("test", "r");
    fseek(f2, 14, SEEK_SET);
    if (getc(f2) != EOF) {
	error("setbuf error 2\n");
    }
    putc('a', f1);
    clearerr(f2);
    c = getc(f2);
    if (c != 0) {
	error("setbuf error 3\n");
    }
    fseek(f2, BUFSIZ-3, SEEK_CUR);
    c = getc(f2);
    if ((c&0xff) != ((BUFSIZ-2)&0xff)) {
	error("setbuf error 4\n");
    }
    if (getc(f2) != 'a') {
	error("setbuf error 5\n");
    }
    if (getc(f2) != EOF) {
	error("setbuf error 6\n");
    }
    fseek(f1, 0, SEEK_SET);
    clearerr(f2);
    fseek(f2, 0, SEEK_SET);
    setlinebuf(f1);
    putc('a', f1);
    c = getc(f2);
    if (c != '1') {
	error("setlinebuf error 1\n");
    }
    putc('\n', f1);
    f2 = freopen("test", "r", f2);
    if (getc(f2) != 'a') {
	error("setlinebuf error 2\n");
    }
    if (getc(f2) != '\n') {
	error("setlinebuf error 3\n");
    }
    fclose(f2);
    fclose(f1);
    f1 = fopen("test", "w");
    if (f1 == NULL) {
	error("setbuffer error 1\n");
    }
    setbuffer(f1, buf, 5);
    fputs("ABCD", f1);
    if (strncmp(buf, "ABCD", 4) != 0) {
	error("setbuffer error 2\n");
    }
    CheckFile("test", "", "setbuffer error 3\n");
    putc('E', f1);
    CheckFile("test", "ABCDE", "setbuffer error 4\n");
    setbuffer(f1, 0, 1000);
    putc('F', f1);
    CheckFile("test", "ABCDEF", "setbuffer error 5\n");
    fclose(f1);
    fclose(f2);

    /*
     * ungetc
     */

    f1 = fopen("test", "r");
    (void) getc(f1);
    (void) getc(f1);
    if (ungetc('x', f1) != 'x') {
	error("ungetc error 1\n");
    }
    if (ungetc('y', f1) != 'y') {
	error("ungetc error 2\n");
    }
    if (ungetc('a', f1) != EOF) {
	error("ungetc error 3\n");
    }
    fgets(buf, 100, f1);
    if (getc(f1) != EOF) {
	error("ungetc error 4\n");
    }
    if (ungetc('#', f1) != '#') {
	error("ungetc error 5\n");
    }
    if (ungetc(EOF, f1) != EOF) {
	error("ungetc error 6\n");
    }
    if (getc(f1) != '#') {
	error("ungetc error 7\n");
    }
    if (getc(f1) != EOF) {
	error("ungetc error 8\n");
    }

    /*
     * fopen
     */

    f1 = fopen("test", "w");
    if (f1 == NULL) {
	error("fopen error 1\n");
    }
    CheckFile("test", "", "fopen error 2\n");
    fputs("Test output", f1);
    fseek(f1, 0, SEEK_SET);
    if (getc(f1) != EOF) {
	error("fopen error 3\n");
    }
    fclose(f1);
    f1 = fopen("test", "r");
    if (f1 == NULL) {
	error("fopen error 4\n");
    }
    if (getc(f1) != 'T') {
	error("fopen error 5\n");
    }
    if (putc('x', f1) != EOF) {
	error("fopen error 6\n");
    }
    fclose(f1);
    f1 = fopen("test", "a");
    if (f1 == NULL) {
	error("fopen error 7\n");
    }
    fputs(" continued", f1);
    fseek(f1, 0, SEEK_SET);
    fputs(" again", f1);
    fclose(f1);
    CheckFile("test", " againutput continued", "fopen error 8\n");
    f1= fopen("test", "w");
    fputs("Test output continued again", f1);
    fclose(f1);
    f1= fopen("test", "rb+");
    if (f1 == NULL) {
	error("fopen error 9\n");
    }
    if (getc(f1) != 'T') {
	error("fopen error 10\n");
    }
    fseek(f1, 0, SEEK_CUR);
    if (fputs("urd", f1) == EOF) {
	error("fopen error 11\n");
    }
    fclose(f1);
    CheckFile("test", "Turd output continued again", "fopen error 12\n");
    f1 = fopen("test", "w+");
    if (f1 == NULL) {
	error("fopen error 13\n");
    }
    CheckFile("test", "", "fopen error 14\n");
    if (fputs("Again", f1) == EOF) {
	error("fopen error 15\n");
    }
    fclose(f1);
    f1 = fopen("test", "a+b");
    if (f1 == NULL) {
	error("fopen error 16\n");
    }
    fputs(" written", f1);
    fflush(f1);
    CheckFile("test", "Again written", "fopen error 17\n");
    fseek(f1, 0, SEEK_SET);
    if (getc(f1) != 'A') {
	error("fopen error 18\n");
    }
    fseek(f1, 0, SEEK_CUR);
    fputs(" to\n", f1);
    fclose(f1);
    CheckFile("test", "A to\n written", "fopen error 19\n");
    f1 = fopen("test", "w");
    fputs("Again written to\n", f1);
    fclose(f1);
    if (fopen("test", "q") != NULL) {
	error("fopen error 20\n");
    }
    if (fopen("test", "ba") != NULL) {
	error("fopen error 21\n");
    }

    /*
     * fdopen, freopen
     */

    fd = open("test", O_RDONLY, 0666);
    if (fd == -1) {
	error("fdopen error 1\n");
    }
    f1 = fdopen(fd, "r");
    if (fgets(buf, 100, f1) == NULL) {
	error("fdopen error 2\n");
    }
    if (strcmp(buf, "Again written to\n") != 0) {
	error("fdopen error 3\n");
    }
    /*
     * Tricky stuff:  it must be possible to have two FILE's open
     * simultaneously on the same stream id.  Sounds crazy, but some
     * UNIX programs depend on it.
     */
    f2 = fopen("test2", "w");
    f3 = fdopen(fileno(f2), "w");
    if (fputs("Test1", f2) == NULL) {
	error("fdopen error 4\n");
    }
    if (fputs("Test2", f3) == NULL) {
	error("fdopen error 5\n");
    }
    if (fputs(" and test3", f2) == NULL) {
	error("fdopen error 6\n");
    }
    if (fputs(" and test4", f3) == NULL) {
	error("fdopen error 7\n");
    }
    fflush(f2);
    fflush(f3);
    CheckFile("test2", "Test1 and test3Test2 and test4", "fdopen error 8\n");
    fclose(f2);
    fclose(f3);
    /*
     * More tricky stuff:  fdopen must seek to the end of the file in
     * "a" mode:  some UNIX programs depend on it.
     */
    fd = open("test2", O_WRONLY, 0666);
    if (fd == -1) {
	error("fdopen error 9\n");
    }
    f2 = fdopen(fd, "a");
    fputs(" and more", f2);
    fclose(f2);
    CheckFile("test2", "Test1 and test3Test2 and test4 and more",
	    "fdopen error 10\n");

    f1 = freopen("test2", "w", f1);
    if (f1 == NULL) {
	error("freopen error 1\n");
    }
    if (fputs("Output data\n", f1) == EOF) {
	error("freopen error 2\n");
    }
    f1 = freopen("test2", "r", f1);
    if (f1 == NULL) {
	error("freopen error 3\n");
    }
    if (fgets(buf, 100, f1) == NULL) {
	error("freopen error 4\n");
    }
    if (strcmp(buf, "Output data\n") != 0) {
	error("freopen error 5\n");
    }
    CheckFile("test2", "Output data\n", "freopen error 6\n");
    fclose(f1);

    /*
     * feof, ferror, clearerr
     */

    f1 = fopen("test", "r");
    f2 = fopen("test", "w");
    if ((f1 == NULL) || (f2 == NULL)) {
	error("ferror error 1\n");
    }
    if (getc(f1) != EOF) {
	error("ferror error 2\n");
    }
    if (!feof(f1)) {
	error("ferror error 3\n");
    }
    putc('a', f2);
    fclose(f2);
    if (getc(f1) != EOF) {
	error("ferror error 4\n");
    }
    if (!feof(f1)) {
	error("ferror error 5\n");
    }
    clearerr(f1);
    if (feof(f1)) {
	error("ferror error 6\n");
    }
    if (getc(f1) != 'a') {
	error("ferror error 7\n");
    }
    if (feof(f1)) {
	error("ferror error 8\n");
    }
    if (getc(f1) != EOF) {
	error("ferror error 9\n");
    }
    if (!feof(f1)) {
	error("ferror error 10\n");
    }
    fclose(f1);
    fd = open("test", O_RDONLY, 0666);
    if (fd == -1) {
	error("ferror error 11\n");
    }
    f1 = fdopen(fd, "r+");
    setvbuf(f1, 0, _IONBF, 1);
    if (putc('x', f1) != EOF) {
	error("ferror error 12\n");
    }
    if (ferror(f1) == 0) {
	error("ferror error 13\n");
    }
    fseek(f1, 0, 0);
    if (getc(f1) != EOF) {
	error("ferror error 14\n");
    }
    if (ferror(f1) == 0) {
	error("ferror error 15\n");
    }
    clearerr(f1);
    if (ferror(f1) != 0) {
	error("ferror error 16\n");
    }
    if (getc(f1) != 'a') {
	error("ferror error 17\n");
    }
    fclose(f1);

    /*
     * _cleanup
     */

    if (fork() == 0) {
	f1 = fopen("test", "w");
	if (f1 == NULL) {
	    error("_cleanup error 1\n");
	}
	fputs("Test string", f1);
	exit(0);
    }
    wait(&status);
    if (status.w_T.w_Retcode == 0) {
	CheckFile("test", "Test string", "_cleanup error 2\n");
    }

    /*
     * fprintf
     */

    f1 = fopen("test", "w");
    f2 = fopen("test", "r");
    if ((f1 == NULL) || (f2 == NULL)) {
	error("sprintf error 1\n");
    }
    setvbuf(f1, 0, _IOLBF, BUFSIZ);
    length = fprintf(f1, "%*d %d %d %d\n", 6, 34, 16923, -12, -1);
    CheckNext(f2, "    34 16923 -12 -1\n", length, "fprintf error 2\n");
    length = fprintf(f1, "%4d %4d %4d %4d %d %#x %#X\n", 6, 34,
	    16923, -12, -1, 0, 0);

    CheckNext(f2, "   6   34 16923  -12 -1 0 0\n", length,
	    "fprintf error 3\n");

    length = fprintf(f1, "%4u %4u %4u %4u %d %#o\n", 6, 34, 16923, -12, -1, 0);
    CheckNext(f2, "   6   34 16923 4294967284 -1 0\n", length,
	    "fprintf error 4\n");

    length = fprintf(f1, "%-4d %-4d %-4d %-4ld\n", 6, 34, 16923, -12, -1);
    CheckNext(f2, "6    34   16923 -12 \n", length,
	    "fprintf error 5\n");

    length = fprintf(f1, "%04d %04d %04d %04d\n", 6, 34, 16923, -12, -1);
    CheckNext(f2, "0006 0034 16923 -012\n", length,
	    "fprintf error 6\n");

    length = fprintf(f1, "%00*d\n", 6, 34, 16923, -12, -1);
    CheckNext(f2, "000034\n", length, "fprintf error 7\n");

    length = fprintf(f1, "%4x %4x %4x %4x\n", 6, 34, 16923, -12, -1);
    CheckNext(f2, "   6   22 421b fffffff4\n", length,
	    "fprintf error 8\n");

    length = fprintf(f1, "%#x %#X %#X %#x\n", 6, 34, 16923, -12, -1);
    CheckNext(f2, "0x6 0X22 0X421B 0xfffffff4\n", length,
	    "fprintf error 9\n");

    length = fprintf(f1, "%#20x %#20x %#20x %#20x\n", 6, 34, 16923, -12, -1);
    CheckNext(f2, "                 0x6                 0x22               0x421b           0xfffffff4\n", length, "fprintf error 10\n");

    length = fprintf(f1, "%-#20x %-#20x %-#20x %-#20x\n", 6, 34, 16923, -12, -1);
    CheckNext(f2, "0x6                  0x22                 0x421b               0xfffffff4          \n", length, "fprintf error 11\n");

    length = fprintf(f1, "%-#20o %#-20o %#-20o %#-20o\n", 6, 34, 16923, -12, -1);
    CheckNext(f2, "06                   042                  041033               037777777764        \n", length, "fprintf error 12\n");

    length = fprintf(f1, "%s %s %c %s\n", "abcd",
	    "This is a very long test string.", 'x', "x");
    CheckNext(f2, "abcd This is a very long test string. x x\n", length,
	    "fprintf error 13\n");

    length = fprintf(f1, "%20s %20s %20c %20s\n", "abcd",
	    "This is a very long test string.", 'x', "x");
    CheckNext(f2, "                abcd This is a very long test string.                    x                    x\n", length, "fprintf error 14\n");

    length = fprintf(f1, "%.10s %.10s %c %.10s\n", "abcd",
	    "This is a very long test string.", 'x', "x");
    CheckNext(f2, "abcd This is a  x x\n", length, "fprintf error 15\n");

    length = fprintf(f1, "%s %s %1 %% %c %s\n", "abcd",
	    "This is a very long test string.", 'x', "x");
    CheckNext(f2, "abcd This is a very long test string.  % x x\n", length,
	    "fprintf error 16\n");

    length = fprintf(f1, "%e %e %e %e\n", 34.2e102, 16923.0/247,
	    -.125, -16000., .000053);
    CheckNext(f2, "3.420000e+103 6.851417e+01 -1.250000e-01 -1.600000e+04\n", length, "fprintf error 17\n");

    length = fprintf(f1, "%20e %20e %20e %20e\n", 34.2e102, 16923.0/247,
	    -.125, -16000., .000053);
    CheckNext(f2, "       3.420000e+103         6.851417e+01        -1.250000e-01        -1.600000e+04\n", length, "fprintf error 18\n");

    length = fprintf(f1, "%.1e %.1e %.1e %.1e\n", 34.2e102, 16923.0/247,
	    -.125, -16000., .000053);
    CheckNext(f2, "3.4e+103 6.9e+01 -1.3e-01 -1.6e+04\n", length,
	    "fprintf error 19\n");

    length = fprintf(f1, "%020e %020e %020e %020e\n", 34.2e102, 16923.0/247,
	    -.125, -16000., .000053);
    CheckNext(f2, "00000003.420000e+103 000000006.851417e+01 -00000001.250000e-01 -00000001.600000e+04\n", length, "fprintf error 20\n");

    length = fprintf(f1, "%7.1e %7.1e %7.1e %7.1e\n", 34.2e102, 16923.0/247,
	    -.125, -16000., .000053);
    CheckNext(f2, "3.4e+103 6.9e+01 -1.3e-01 -1.6e+04\n", length,
	    "fprintf error 21\n");

    length = fprintf(f1, "%f %f %f %f\n", 34.2e102, 16923.0/247,
	    -.125, -16000., .000053);
    CheckNext(f2, "34200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.000000 68.514170 -0.125000 -16000.000000\n", length, "fprintf error 22\n");

    length = fprintf(f1, "%.4f %.4f %.4f %.4f %.4f\n", 34.2e102, 16923.0/247,
	    -.125, -16000., .000053);
    CheckNext(f2, "34200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0000 68.5142 -0.1250 -16000.0000 0.0001\n", length, "fprintf error 23\n");

    length = fprintf(f1, "%.4e %.5e %.6e\n", -9.99995, -9.99995, 9.99995);
    CheckNext(f2, "-1.0000e+01 -9.99995e+00 9.999950e+00\n", length,
	    "fprintf error 24\n");

    length = fprintf(f1, "%.4f %.5f %.6f\n", -9.99995, -9.99995, 9.99995);
    CheckNext(f2, "-10.0000 -9.99995 9.999950\n", length,
	    "fprintf error 25\n");

    length = fprintf(f1, "%20f %-20f %020f\n", -9.99995, -9.99995, 9.99995);
    CheckNext(f2, "           -9.999950 -9.999950            0000000000009.999950\n", length, "fprintf error 26\n");

    length = fprintf(f1, "%-020f %020f\n", -9.99995, -9.99995, 9.99995);
    CheckNext(f2, "-9.999950            -000000000009.999950\n", length,
	    "fprintf error 27\n");

    length = fprintf(f1, "%.0e %#.0e\n", -9.99995, -9.99995, 9.99995);
    CheckNext(f2, "-1e+01 -1.e+01\n", length, "fprintf error 28\n");

    length = fprintf(f1, "%.0f %#.0f\n", -9.99995, -9.99995, 9.99995);
    CheckNext(f2, "-10 -10.\n", length, "fprintf error 29\n");

    length = fprintf(f1, "%.4f %.5f %.6f\n", -9.99995, -9.99995, 9.99995);
    CheckNext(f2, "-10.0000 -9.99995 9.999950\n", length,
	    "fprintf error 30\n");

    length = fprintf(f1, "%.3g\n", 12341.0);
    CheckNext(f2, "1.23e+04\n", length, "fprintf error 31\n");

    length = fprintf(f1, "%.3G\n", 1234.12345);
    CheckNext(f2, "1.23E+03\n", length, "fprintf error 32\n");

    length = fprintf(f1, "%.3g\n", 123.412345);
    CheckNext(f2, "123\n", length, "fprintf error 33\n");

    length = fprintf(f1, "%.3g\n", 12.3412345);
    CheckNext(f2, "12.3\n", length, "fprintf error 34\n");

    length = fprintf(f1, "%.3g\n", 1.23412345);
    CheckNext(f2, "1.23\n", length, "fprintf error 35\n");

    length = fprintf(f1, "%.3g\n", .123412345);
    CheckNext(f2, "0.123\n", length, "fprintf error 36\n");

    length = fprintf(f1, "%.3g\n", .012341);
    CheckNext(f2, "0.0123\n", length, "fprintf error 37\n");

    length = fprintf(f1, "%.3g\n", .0012341);
    CheckNext(f2, "0.00123\n", length, "fprintf error 38\n");

    length = fprintf(f1, "%.3g\n", .00012341);
    CheckNext(f2, "0.000123\n", length, "fprintf error 39\n");

    length = fprintf(f1, "%.3g\n", .00001234);
    CheckNext(f2, "1.23e-05\n", length, "fprintf error 40\n");

    length = fprintf(f1, "%.4g\n", 9999.5);
    CheckNext(f2, "1e+04\n", length, "fprintf error 41\n");

    length = fprintf(f1, "%.4g\n", 999.95);
    CheckNext(f2, "1000\n", length, "fprintf error 42\n");

    length = fprintf(f1, "%.3g\n", 1.0);
    CheckNext(f2, "1\n", length, "fprintf error 43\n");

    length = fprintf(f1, "%.\n", 1.0);
    CheckNext(f2, "\n", length, "fprintf error 44\n");

    length = fprintf(f1, "%.3g\n", .1);
    CheckNext(f2, "0.1\n", length, "fprintf error 45\n");

    length = fprintf(f1, "%.3g\n", .01);
    CheckNext(f2, "0.01\n", length, "fprintf error 46\n");

    length = fprintf(f1, "%.3g\n", .001);
    CheckNext(f2, "0.001\n", length, "fprintf error 47\n");

    length = fprintf(f1, "%.3g\n", .0001);
    CheckNext(f2, "1e-04\n", length, "fprintf error 48\n");

    length = fprintf(f1, "%.3g\n", .00001);
    CheckNext(f2, "1e-05\n", length, "fprintf error 49\n");

    length = fprintf(f1, "%#.3g\n", 1234.0);
    CheckNext(f2, "1.23e+03\n", length, "fprintf error 50\n");

    length = fprintf(f1, "%#.3G\n", 9999.5);
    CheckNext(f2, "1.00E+04\n", length, "fprintf error 51\n");

    length = fprintf(f1, "%e %f %g\n", 0.0, 0.0, 0.0, 0.0);
    CheckNext(f2, "0.000000e+00 0.000000 0\n", length, "fprintf error 52\n");

    length = fprintf(f1, "%.4e %.4f %.4g\n", 0.0, 0.0, 0.0, 0.0);
    CheckNext(f2, "0.0000e+00 0.0000 0\n", length, "fprintf error 53\n");

    length = fprintf(f1, "%#.4e %#.4f %#.4g\n", 0.0, 0.0, 0.0, 0.0);
    CheckNext(f2, "0.0000e+00 0.0000 0.000\n", length, "fprintf error 54\n");

    length = fprintf(f1, "%.0e %.0f %.0g\n", 0.0, 0.0, 0.0, 0.0);
    CheckNext(f2, "0e+00 0 0\n", length, "fprintf error 55\n");

    length = fprintf(f1, "%#.0e %#.0f %#.0g\n", 0.0, 0.0, 0.0, 0.0);
    CheckNext(f2, "0.e+00 0. 0.\n", length, "fprintf error 56\n");

    length = fprintf(f1, "%3.0f %3.0f %3.0f %3.0f\n", 0.0, 0.1, 0.01, 0.001);
    CheckNext(f2, "  0   0   0   0\n", length, "fprintf error 57\n");

    length = fprintf(f1, "%3.0f %3.0f %3.0f %3.0f\n", 1.0, 1.1, 1.01, 1.001);
    CheckNext(f2, "  1   1   1   1\n", length, "fprintf error 58\n");

    length = fprintf(f1, "%3.1f %3.1f %3.1f %3.1f\n", 0.0, 0.1, 0.01, 0.001);
    CheckNext(f2, "0.0 0.1 0.0 0.0\n", length, "fprintf error 59\n");

    fclose(f1);
    fclose(f2);

    /*
     * sscanf
     */

    count = sscanf("-20 1476 \n33 0", "%d %d %d %d", &d1, &d2, &d3, &d4);
    if ((count != 4) || (d1 != -20) || (d2 != 1476) || (d3 != 33)
	    || (d4 != 0)) {
	error("sscanf error 1\n");
    }

    d4 = -1;
    count = sscanf("-45 16 7890 +10", "%2d %*d %10d %d", &d1, &d2, &d3, &d4);
    if ((count != 3) || (d1 != -4) || (d2 != 16) || (d3 != 7890)
	    || (d4 != -1)) {
	error("sscanf error 2\n");
    }

    count = sscanf("-45 16 +10 987", "%D %  %hD %d", &d1, &d2, &d3, &d4);
    if ((count != 4) || (d1 != -45) || (d2 != 16) || (d3 != 10)
	    || (d4 != 987)) {
	error("sscanf error 3\n");
    }

    sa1[0] = sa1[1] = sa1[2] = sa2[0] = sa2[1] = sa2[2] = -1;
    count = sscanf("14 1ab 62 10", "%hd %x %O %hx", &sa1[1], &d2, &d3,
	    &sa2[1]);
    if ((count != 4) || (sa1[0] != -1) || (sa1[1] != 14) || (sa1[2] != -1)
	    || (d2 != 427) || (d3 != 50) || (sa2[0] != -1) || (sa2[1] != 0x10)
	    || (sa2[2] != -1)) {
	error("sscanf error 4\n");
    }

    count = sscanf("12345670 1234567890ab cdefg", "%o	 %o %x %X",
	    &d1, &d2, &d3, &d4);
    if ((count != 4) || (d1 != 2739128) || (d2 != 342391) || (d3 != 561323)
	    || (d4 != 52719)) {
	error("sscanf error 5\n");
    }

    count = sscanf("ab123-24642", "%2x %3hx %3o %2ho", &d1, &s1, &d3, &s2);
    if ((count != 4) || (d1 != 171) || (s1 != 0x123) || (d3 != -20)
	    || (s2 != 0x34)) {
	error("sscanf error 6\n");
    }

    d2 = d3 = d4 = -1;
    count = sscanf("42 43", "%d %", &d1, &d2, &d3, &d4);
    if ((count != -1) || (d1 != 42) || (d2 != -1) || (d3 != -1)
	    || (d4 != -1)) {
	error("sscanf error 7\n");
    }

    d2 = d3 = d4 = -1;
    count = sscanf("42", "%d", &d1, &d2, &d3, &d4);
    if ((count != 1) || (d1 != 42) || (d2 != -1) || (d3 != -1)
	    || (d4 != -1)) {
	error("sscanf error 8\n");
    }

    d2 = d3 = d4 = -1;
    count = sscanf("1 2 3 4 5", "%q %r", &d1, &d2, &d3, &d4);
    if ((count != 2) || (d1 != 1) || (d2 != 2) || (d3 != -1)
	    || (d4 != -1)) {
	error("sscanf error 9\n");
    }

    d3 = d4 = -1;
    count = sscanf("1234567 234 567  ", "%*3x %x %*o %4o", &d1, &d2, &d3, &d4);
    if ((count != 2) || (d1 != 17767) || (d2 != 375) || (d3 != -1)
	    || (d4 != -1)) {
	error("sscanf error 10\n");
    }

    d3 = d4 = -1;
    count = sscanf("1234567 234 567  ", "%*3x %x %*o %4o", &d1, &d2, &d3, &d4);
    if ((count != 2) || (d1 != 17767) || (d2 != 375) || (d3 != -1)
	    || (d4 != -1)) {
	error("sscanf error 11\n");
    }

    d1 = d2 = d3 = d4 = -1;
    count = sscanf("a	1234", "%d %d", &d1, &d2, &d3, &d4);
    if ((count != 0) || (d1 != -1) || (d2 != -1) || (d3 != -1)
	    || (d4 != -1)) {
	error("sscanf error 11\n");
    }

    count = sscanf("12345678", "%2d %2d %2d %2d", &d1, &d2, &d3, &d4);
    if ((count != 4) || (d1 != 12) || (d2 != 34) || (d3 != 56)
	    || (d4 != 78)) {
	error("sscanf error 12\n");
    }

    d3 = d4 = -1;
    count = sscanf("1 2 ", "%d %d %d %d", &d1, &d2, &d3, &d4);
    if ((count != 2) || (d1 != 1) || (d2 != 2) || (d3 != -1)
	    || (d4 != -1)) {
	error("sscanf error 13\n");
    }

    d1 = d2 = d3 = d4 = -1;
    count = sscanf("  a", " a%d %d %d %d", &d1, &d2, &d3, &d4);
    if ((count != -1) || (d1 != -1) || (d2 != -1) || (d3 != -1)
	    || (d4 != -1)) {
	error("sscanf error 14\n");
    }

    fp4 = -1.0;
    count = sscanf("2.1 -3.0e8 .99962 a", "%f%f%f%f", &fp1, &fp2, &fp3, &fp4);
    CheckFp(count, 3, fp1, fp2, fp3, fp4,
	    "2.100000e+00 -3.000000e+08 9.996200e-01 -1.000000e+00",
	    "sscanf error 15\n");

    count = sscanf("-1.2345 +8.2 9", "%3e %3f %f %f", &fp1, &fp2, &fp3, &fp4);
    CheckFp(count, 4, fp1, fp2, fp3, fp4,
	    "-1.000000e+00 2.340000e+02 5.000000e+00 8.200000e+00",
	    "sscanf error 16\n");

    fp4 = -1.0;
    count = sscanf("1e00004 332E-4 3e+4", "%f %*2e %f %f", &fp1,
	    &fp2, &fp3, &fp4);
    CheckFp(count, 3, fp1, fp2, fp3, fp4,
	    "1.000000e+04 2.000000e-04 3.000000e+04 -1.000000e+00",
	    "sscanf error 17\n");

    fp4 = -1.0;
    count = sscanf("1. 47.6 2.e2 3.e-", "%f %*f %f %f", &fp1, &fp2,
	    &fp3, &fp4);
    CheckFp(count, 3, fp1, fp2, fp3, fp4,
	    "1.000000e+00 2.000000e+02 3.000000e+00 -1.000000e+00",
	    "sscanf error 18\n");

    fp3 = fp4 = -1.0;
    count = sscanf("1.eabc", "%f %x", &fp1, &fp2, &fp3, &fp4);
    CheckFp(count, 2, fp1, fp2, fp3, fp4,
	    "1.000000e+00 3.850768e-42 -1.000000e+00 -1.000000e+00",
	    "sscanf error 19\n");

    count = sscanf("4.6 99999.7 876.43e-1 118", "%f %f %f %e",
	    &fp1, &fp2, &fp3, &fp4);
    CheckFp(count, 4, fp1, fp2, fp3, fp4,
	    "4.600000e+00 9.999970e+04 8.764300e+01 1.180000e+02",
	    "sscanf error 20\n");

    count = sscanf("1.2345 697.0e-3 124 .00005", "%F %E %lf %le",
	    &dbl1, &dbl2, &dbl3, &dbl4);
    CheckFp(count, 4, dbl1, dbl2, dbl3, dbl4,
	    "1.234500e+00 6.970000e-01 1.240000e+02 5.000000e-05",
	    "sscanf error 21\n");

    count = sscanf("4.6 99999.7 876.43e-1 118", "%F %F %F %F",
	    &dbl1, &dbl2, &dbl3, &dbl4);
    CheckFp(count, 4, dbl1, dbl2, dbl3, dbl4,
	    "4.600000e+00 9.999970e+04 8.764300e+01 1.180000e+02",
	    "sscanf error 22\n");

    dbl2 = dbl3 = dbl4 = -1.0;
    count = sscanf("4.6abc", "%F %F %f %f",
	    &dbl1, &dbl2, &dbl3, &dbl4);
    CheckFp(count, 1, dbl1, dbl2, dbl3, dbl4,
	    "4.600000e+00 -1.000000e+00 -1.000000e+00 -1.000000e+00",
	    "sscanf error 23\n");

    dbl3 = dbl4 = -1.0;
    count = sscanf("4.6 5.2", "%F %F %F %F",
	    &dbl1, &dbl2, &dbl3, &dbl4);
    CheckFp(count, 2, dbl1, dbl2, dbl3, dbl4,
	    "4.600000e+00 5.200000e+00 -1.000000e+00 -1.000000e+00",
	    "sscanf error 24\n");

    CheckString("abc defghijk dum ", "%s %3s %20s %s", 4,
	    "abc", "def", "ghijk", "dum",
	    "sscanf error 25\n");

    CheckString("abc       bcdef", "%5c%c%1s %s", 4,
	    "abc  ", " XXXX", "b", "cdef",
	    "sscanf error 26\n");

    CheckString("123456 test ", "%*c%*s %s %s %s", 1,
	    "test", "XXXXX", "XXXXX", "XXXXX",
	    "sscanf error 27\n");

    CheckString("ababcd01234  f 123450", "%4[abcd] %4[abcd] %[^abcdef] %[^0]",
	    4, "abab", "cd", "01234  ", "f 12345",
	    "sscanf error 28\n");

    CheckString("aaaaaabc aaabcdefg  + +  XYZQR",
	    "%*4[a] %s %*4[a]%s%*4[ +]%10c", 3,
	    "aabc", "bcdefg", "+  XYZQR", "XXXXX",
	    "sscanf error 29\n");

    /*
     * printf, scanf, fscanf, sprintf, vprintf, vsprintf
     */

    fd = dup(1);
    fclose(stdout);
    f1 = fopen("test", "w");
    count = printf("%d and %d", 47, 102);
    if (count != 10) {
	error("printf error 1\n");
    }
    count = CheckVprintf("  %x then %x", 15, 65);
    if (count != 11) {
	error("printf error 2\n");
    }
    fclose(stdout);
    CheckFile("test", "47 and 102  f then 41", "printf error 3\n");
    dup2(fd, 1);
    (void) fdopen(1, "w");
    close(fd);

    fd = dup(0);
    fclose(stdin);
    f1 = fopen("test", "r");
    count = scanf("%d and %d %d", &d1, &d2, &d3);
    if ((count != 2) || (d1 != 47) || (d2 != 102)) {
	error("scanf error 1\n");
    }
    fclose(stdin);
    dup2(fd, 0);
    (void) fdopen(0, "r");
    close(fd);

    f1 = fopen("test", "r");
    count = fscanf(f1, "%d and %d %d", &d1, &d2, &d3);
    if ((count != 2) || (d1 != 47) || (d2 != 102)) {
	error("fscanf error 1\n");
    }
    fclose(f1);

    if (sprintf(buf, "%s %d", "The value is", 19) != buf) {
	error("sprintf error 1\n");
    }
    if (strcmp(buf, "The value is 19") != 0) {
	error("sprintf error 2\n");
    }

    if (CheckVsprintf(buf, "%s %d", "The value is", 19) != buf) {
	error("vsprintf error 1\n");
    }
    if (strcmp(buf, "The value is 19") != 0) {
	error("vsprintf error 2\n");
    }
}
@


1.12.1.1
log
@Initial branch for Sprite server.
@
text
@d20 1
a20 1
static char rcsid[] = "$Header: /sprite/src/tests/stdio/RCS/stdio.c,v 1.12 91/12/12 13:43:34 shirriff Exp $ SPRITE (Berkeley)";
@


1.11
log
@Fprintf checks 22 and 23 needed to be adjusted again (I don't
know why floating-poin results keep changing), and Fred made changes
to match changes to fseek code.
@
text
@d20 1
a20 1
static char rcsid[] = "$Header: /sprite/src/tests/stdio/RCS/stdio.c,v 1.10 88/12/15 09:50:57 ouster Exp Locker: douglis $ SPRITE (Berkeley)";
d30 11
d44 4
d201 1
d490 6
a495 1
    CheckFile("test", "a\1\2\3\377\4\5\6\7", "putw error 5\n");
@


1.10
log
@Floating-point conversion has changed slightly.  Update test values.
@
text
@d20 1
a20 1
static char rcsid[] = "$Header: /t2/test/src/cmds/stdio/RCS/stdio.c,v 1.9 88/10/23 15:39:22 ouster Exp $ SPRITE (Berkeley)";
d708 80
d874 1
a874 1
    fseek(f2, 0, SEEK_SET);
d908 1
a908 1
    if (ungetc('x', f1) != 0) {
d911 1
a911 1
    if (ungetc('y', f1) != 0) {
d921 1
a921 1
    if (ungetc('#', f1) != 0) {
d968 4
a971 1
    CheckFile("test", "Test output continued again", "fopen error 8\n");
d1008 4
a1011 1
    CheckFile("test", "Again written to\n", "fopen error 19\n");
d1269 1
a1269 1
    CheckNext(f2, "34200000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.000000 68.514170 -0.125000 -16000.000000\n", length, "fprintf error 22\n");
d1273 1
a1273 1
    CheckNext(f2, "34200000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0000 68.5142 -0.1250 -16000.0000 0.0001\n", length, "fprintf error 23\n");
@


1.9
log
@Change position of "#" in formats, permit flags in any order.
@
text
@d20 1
a20 1
static char rcsid[] = "$Header: /t2/test/src/cmds/stdio/RCS/stdio.c,v 1.8 88/10/01 10:17:12 ouster Exp Locker: ouster $ SPRITE (Berkeley)";
d1183 1
a1183 1
    CheckNext(f2, "34200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.000000 68.514170 -0.125000 -16000.000000\n", length, "fprintf error 22\n");
d1187 1
a1187 1
    CheckNext(f2, "34200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0000 68.5142 -0.1250 -16000.0000 0.0001\n", length, "fprintf error 23\n");
d1332 1
a1332 1
	    || (sa2[2] != 0xffff)) {
@


1.8
log
@Make sure fdopen seeks to EOF when opened mode "a".
@
text
@d20 1
a20 1
static char rcsid[] = "$Header: stdio.c,v 1.7 88/07/21 10:57:09 ouster Exp $ SPRITE (Berkeley)";
d1132 1
a1132 1
    length = fprintf(f1, "%20#x %20#x %20#x %20#x\n", 6, 34, 16923, -12, -1);
d1135 1
a1135 1
    length = fprintf(f1, "%-20#x %-20#x %-20#x %-20#x\n", 6, 34, 16923, -12, -1);
d1138 1
a1138 1
    length = fprintf(f1, "%-20#o %-20#o %-20#o %-20#o\n", 6, 34, 16923, -12, -1);
d1204 1
a1204 1
    length = fprintf(f1, "%.0e %.0#e\n", -9.99995, -9.99995, 9.99995);
d1207 1
a1207 1
    length = fprintf(f1, "%.0f %.0#f\n", -9.99995, -9.99995, 9.99995);
d1271 1
a1271 1
    length = fprintf(f1, "%.3#g\n", 1234.0);
d1274 1
a1274 1
    length = fprintf(f1, "%.3#G\n", 9999.5);
d1283 1
a1283 1
    length = fprintf(f1, "%.4#e %.4#f %.4#g\n", 0.0, 0.0, 0.0, 0.0);
d1289 1
a1289 1
    length = fprintf(f1, "%.0#e %.0#f %.0#g\n", 0.0, 0.0, 0.0, 0.0);
@


1.7
log
@Changed return value from putc and fputc.
@
text
@d20 1
a20 1
static char rcsid[] = "$Header: stdio.c,v 1.6 88/07/21 09:35:31 ouster Exp $ SPRITE (Berkeley)";
d972 13
@


1.6
log
@Added more tests for fdopen, vprintf, vsprintf.
@
text
@d20 1
a20 1
static char rcsid[] = "$Header: stdio.c,v 1.5 88/07/20 18:11:18 ouster Exp $ SPRITE (Berkeley)";
d343 1
a343 1
    if (fputc('c', f1) != 0) {
d346 1
a346 1
    if (fputc('\n', f1) != 0) {
d357 14
d373 1
a373 1
	error("putc error 9\n");
d376 1
a376 1
	error("putc error 10\n");
d379 1
a379 1
	error("putc error 11\n");
@


1.5
log
@Mods for change to fdopen.
@
text
@d20 1
a20 1
static char rcsid[] = "$Header: stdio.c,v 1.4 88/06/13 09:59:55 ouster Exp $ SPRITE (Berkeley)";
d28 1
d239 62
d319 1
a319 1
    FILE *f1, *f2;
d924 1
a924 2
    fd2 = open("test", O_RDONLY, 0666);
    if (fd2 == -1) {
d927 1
a927 1
    f1 = fdopen(fd2, "r");
d934 25
a965 1
    close(fd);
d1469 1
a1469 1
     * printf, scanf, fscanf, sprintf
d1479 4
d1484 1
a1484 1
    CheckFile("test", "47 and 102", "printf error 2\n");
d1513 7
@


1.4
log
@Added getw and putw.  Should be complete now.
@
text
@d20 1
a20 1
static char rcsid[] = "$Header: stdio.c,v 1.3 88/06/10 10:19:52 ouster Exp $ SPRITE (Berkeley)";
d437 1
a437 1
    close(1);
d464 1
d474 1
a474 1
    close(0);
d504 1
d1395 2
a1396 1
    dup(1, fd);
d1407 2
a1408 1
    dup(0, fd);
@


1.3
log
@Intermediate check-in.
@
text
@d20 1
a20 1
static char rcsid[] = "$Header: stdio.c,v 1.2 88/06/06 17:46:50 ouster Exp $ SPRITE (Berkeley)";
d32 1
a32 1

d34 14
a47 2
 * Utility procedure to make sure that a given file contains a
 * given value.  Aborts with error if it doesn't.
d51 1
a51 1
checkFile(name, value, errMsg)
d73 1
a73 1

d75 14
a88 1
 * Structure for testing fwrite, fread.
a96 4
/*
 * Procedure for comparing two of the above structures.
 */

d98 1
a98 1
tsCheck(ts1, ts2, msg)
d113 1
a113 1

d115 15
a129 2
 * Procedure for testing fprintf:  reads back from a file and
 * makes sure what was printed had the right length and content.
d133 1
a133 1
checkNext(f, string, length, msg)
d151 18
d170 84
d264 1
d293 1
a293 1
    checkFile("test", "abc\nThis is the second line.\n", "putc error 8\n");
d376 1
d379 45
d464 1
a464 1
    checkFile("test", "x more on this line.\nA second line.\n",
d542 2
a543 2
    tsCheck(&tsArray1[0], &tsArray2[0], "fread error 3\n");
    tsCheck(&tsArray1[1], &tsArray2[1], "fread error 4\n");
d549 1
a549 1
	    tsCheck(&tsArray1[i-5], &tsArray2[i], "fread error 6\n");
d551 1
a551 1
	    tsCheck(&tsArray1[i+2], &tsArray2[i], "fread error 7\n");
d557 1
a557 1
    tsCheck(&tsArray1[5], &tsArray2[0], "fread error 9\n");
d561 3
a563 3
    tsCheck(&tsArray1[6], &tsArray2[0], "fread error 11\n");
    tsCheck(&tsArray1[7], &tsArray2[1], "fread error 12\n");
    tsCheck(&tsArray1[0], &tsArray2[2], "fread error 13\n");
d597 1
a597 1
    checkFile("test", "ab1defg2ijklmnopqrstuvwxy345", "fseek error 6\n");
d645 1
a645 1
    checkFile("test", "", "setvbuf error 4\n");
d647 1
a647 1
    checkFile("test", "abcd\nefghi", "setvbuf error 5\n");
d657 1
a657 1
    checkFile("test", "123456\nghi", "setvbuf error 8\n");
d661 1
a661 1
    checkFile("test", "123456\n7890", "setvbuf error 10\n");
d663 1
a663 1
    checkFile("test", "123456\n7890", "setvbuf error 11\n");
d667 1
a667 1
    checkFile("test", "123456\n7890X", "setvbuf error 12\n");
d669 1
a669 1
    checkFile("test", "123456\n7890XY", "setvbuf error 13\n");
d674 1
a674 1
    checkFile("test", "123456\n7890XYZ", "setvbuf error 15\n");
d682 1
a682 1
    checkFile("test", "123456\n7890XYZ", "setbuf error 2\n");
d733 1
a733 1
    checkFile("test", "", "setbuffer error 3\n");
d735 1
a735 1
    checkFile("test", "ABCDE", "setbuffer error 4\n");
d738 1
a738 1
    checkFile("test", "ABCDEF", "setbuffer error 5\n");
d783 1
a783 1
    checkFile("test", "", "fopen error 2\n");
d809 1
a809 1
    checkFile("test", "Test output continued again", "fopen error 8\n");
d822 1
a822 1
    checkFile("test", "Turd output continued again", "fopen error 12\n");
d827 1
a827 1
    checkFile("test", "", "fopen error 14\n");
d838 1
a838 1
    checkFile("test", "Again written", "fopen error 17\n");
d846 1
a846 1
    checkFile("test", "Again written to\n", "fopen error 19\n");
d888 1
a888 1
    checkFile("test2", "Output data\n", "freopen error 6\n");
d973 1
a973 1
	checkFile("test", "Test string", "_cleanup error 2\n");
d987 1
a987 1
    checkNext(f2, "    34 16923 -12 -1\n", length, "fprintf error 2\n");
d990 2
a991 1
    checkNext(f2, "   6   34 16923  -12 -1 0 0\n", length,
d993 1
d995 1
a995 1
    checkNext(f2, "   6   34 16923 4294967284 -1 0\n", length,
d997 1
d999 1
a999 1
    checkNext(f2, "6    34   16923 -12 \n", length,
d1001 1
d1003 1
a1003 1
    checkNext(f2, "0006 0034 16923 -012\n", length,
d1005 1
d1007 2
a1008 1
    checkNext(f2, "000034\n", length, "fprintf error 7\n");
d1010 1
a1010 1
    checkNext(f2, "   6   22 421b fffffff4\n", length,
d1012 1
d1014 1
a1014 1
    checkNext(f2, "0x6 0X22 0X421B 0xfffffff4\n", length,
d1016 1
d1018 2
a1019 1
    checkNext(f2, "                 0x6                 0x22               0x421b           0xfffffff4\n", length, "fprintf error 10\n");
d1021 2
a1022 1
    checkNext(f2, "0x6                  0x22                 0x421b               0xfffffff4          \n", length, "fprintf error 11\n");
d1024 2
a1025 1
    checkNext(f2, "06                   042                  041033               037777777764        \n", length, "fprintf error 12\n");
d1028 1
a1028 1
    checkNext(f2, "abcd This is a very long test string. x x\n", length,
d1030 1
d1033 2
a1034 1
    checkNext(f2, "                abcd This is a very long test string.                    x                    x\n", length, "fprintf error 14\n");
d1037 2
a1038 1
    checkNext(f2, "abcd This is a  x x\n", length, "fprintf error 15\n");
d1041 1
a1041 1
    checkNext(f2, "abcd This is a very long test string.  % x x\n", length,
d1043 1
d1046 2
a1047 1
    checkNext(f2, "3.420000e+103 6.851417e+01 -1.250000e-01 -1.600000e+04\n", length, "fprintf error 17\n");
d1050 2
a1051 1
    checkNext(f2, "       3.420000e+103         6.851417e+01        -1.250000e-01        -1.600000e+04\n", length, "fprintf error 18\n");
d1054 1
a1054 1
    checkNext(f2, "3.4e+103 6.9e+01 -1.3e-01 -1.6e+04\n", length,
d1056 1
d1059 2
a1060 1
    checkNext(f2, "00000003.420000e+103 000000006.851417e+01 -00000001.250000e-01 -00000001.600000e+04\n", length, "fprintf error 20\n");
d1063 1
a1063 1
    checkNext(f2, "3.4e+103 6.9e+01 -1.3e-01 -1.6e+04\n", length,
d1065 1
d1068 2
a1069 1
    checkNext(f2, "34200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.000000 68.514170 -0.125000 -16000.000000\n", length, "fprintf error 22\n");
d1072 2
a1073 1
    checkNext(f2, "34200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0000 68.5142 -0.1250 -16000.0000 0.0001\n", length, "fprintf error 23\n");
d1075 1
a1075 1
    checkNext(f2, "-1.0000e+01 -9.99995e+00 9.999950e+00\n", length,
d1077 1
d1079 1
a1079 1
    checkNext(f2, "-10.0000 -9.99995 9.999950\n", length,
d1081 1
d1083 2
a1084 1
    checkNext(f2, "           -9.999950 -9.999950            0000000000009.999950\n", length, "fprintf error 26\n");
d1086 1
a1086 1
    checkNext(f2, "-9.999950            -000000000009.999950\n", length,
d1088 1
d1090 2
a1091 1
    checkNext(f2, "-1e+01 -1.e+01\n", length, "fprintf error 28\n");
d1093 2
a1094 1
    checkNext(f2, "-10 -10.\n", length, "fprintf error 29\n");
d1096 3
a1098 1
    checkNext(f2, "-10.0000 -9.99995 9.999950\n", length, "fprintf error 30\n");
d1100 2
a1101 1
    checkNext(f2, "1.23e+04\n", length, "fprintf error 31\n");
d1103 2
a1104 1
    checkNext(f2, "1.23E+03\n", length, "fprintf error 32\n");
d1106 2
a1107 1
    checkNext(f2, "123\n", length, "fprintf error 33\n");
d1109 2
a1110 1
    checkNext(f2, "12.3\n", length, "fprintf error 34\n");
d1112 2
a1113 1
    checkNext(f2, "1.23\n", length, "fprintf error 35\n");
d1115 2
a1116 1
    checkNext(f2, "0.123\n", length, "fprintf error 36\n");
d1118 2
a1119 1
    checkNext(f2, "0.0123\n", length, "fprintf error 37\n");
d1121 2
a1122 1
    checkNext(f2, "0.00123\n", length, "fprintf error 38\n");
d1124 2
a1125 1
    checkNext(f2, "0.000123\n", length, "fprintf error 39\n");
d1127 2
a1128 1
    checkNext(f2, "1.23e-05\n", length, "fprintf error 40\n");
d1130 2
a1131 1
    checkNext(f2, "1e+04\n", length, "fprintf error 41\n");
d1133 2
a1134 1
    checkNext(f2, "1000\n", length, "fprintf error 42\n");
d1136 2
a1137 1
    checkNext(f2, "1\n", length, "fprintf error 43\n");
d1139 2
a1140 1
    checkNext(f2, "\n", length, "fprintf error 44\n");
d1142 2
a1143 1
    checkNext(f2, "0.1\n", length, "fprintf error 45\n");
d1145 2
a1146 1
    checkNext(f2, "0.01\n", length, "fprintf error 46\n");
d1148 2
a1149 1
    checkNext(f2, "0.001\n", length, "fprintf error 47\n");
d1151 2
a1152 1
    checkNext(f2, "1e-04\n", length, "fprintf error 48\n");
d1154 2
a1155 1
    checkNext(f2, "1e-05\n", length, "fprintf error 49\n");
d1157 2
a1158 1
    checkNext(f2, "1.23e+03\n", length, "fprintf error 50\n");
d1160 1
a1160 1
    checkNext(f2, "1.00E+04\n", length, "fprintf error 51\n");
d1162 27
d1198 1
d1205 1
d1211 7
a1217 4
    d1 = d4 = -1;
    count = sscanf("14 1ab 62 10", "%hd %x %O %hx", &d1, &d2, &d3, &d4);
    if ((count != 4) || (d1 != 0xeffff) || (d2 != 427) || (d3 != 50)
	    || (d4 != 0x10ffff)) {
d1220 1
d1227 4
a1230 4
    d2 = d4 = -1;
    count = sscanf("ab123-24642", "%2x %3hx %3o %2ho", &d1, &d2, &d3, &d4);
    if ((count != 4) || (d1 != 171) || (d2 != 0x123ffff) || (d3 != -20)
	    || (d4 != 0x34ffff)) {
d1233 1
d1240 1
d1247 1
d1254 1
d1261 1
d1268 1
d1275 1
d1281 1
d1288 1
d1295 1
d1298 4
a1301 4
    if ((count != 3) || (fp1 != 2.1) || (fp2 != -3.0e8) || (fp3 != .99962)
	    || (fp4 != -1.0)) {
	error("sscanf error 15\n");
    }
d1303 4
a1306 4
    if ((count != 4) || (fp1 != -1.0) || (fp2 != 234.0) || (fp3 != 5.0)
	    || (fp4 != 8.2)) {
	error("sscanf error 16\n");
    }
d1310 4
a1313 4
    if ((count != 3) || (fp1 != 1.0e4) || (fp2 != 2.0e-04) || (fp3 != 3.0e04)
	    || (fp4 != -1.0)) {
	error("sscanf error 17\n");
    }
d1317 4
a1320 4
    if ((count != 3) || (fp1 != 1.0) || (fp2 != 200) || (fp3 != 3.0)
	    || (fp4 != -1.0)) {
	error("sscanf error 18\n");
    }
d1323 96
a1418 3
    if ((count != 2) || (fp1 != 1.0) || (fp2 != 3.850768e-42) || (fp3 != -1.0)
	    || (fp4 != -1.0)) {
	error("sscanf error 19\n");
@


1.2
log
@*** empty log message ***
@
text
@d20 1
a20 1
static char rcsid[] = "$Header: stdio.c,v 1.1 88/06/06 08:43:33 ouster Exp $ SPRITE (Berkeley)";
d26 2
d93 25
d122 1
a122 1
    int i, fd;
d124 4
d207 1
a207 1
    if (buf[16] != 0377) {
d230 9
d387 1
a387 1
     * fseek and ftell
d398 1
a398 1
    fseek(f1, 2, 0);
d403 1
a403 1
    fseek(f1, 4, 1);
d408 1
a408 1
    fseek(f1, -1, 2);
d415 1
a415 1
    fseek(f1, 1, 0);
d422 1
a422 1
    fseek(f1, -2, 2);
d429 16
d465 1
a465 1
    fseek(f1, 0, 0);
d496 1
a496 1
    if ((buf[0] != 0) || (buf[BUFSIZ-2] != ((BUFSIZ-2)&0xff))) {
d501 1
a501 1
    fseek(f2, 14, 0);
d511 1
a511 1
    fseek(f2, BUFSIZ-3, 1);
d513 1
a513 1
    if (c != (BUFSIZ-2)&0xff) {
d522 1
a522 1
    fseek(f1, 0, 0);
d524 1
a524 1
    fseek(f2, 0, 0);
d532 1
a532 1
    fseek(f2, 0, 0);
d558 493
@


1.1
log
@Initial revision
@
text
@d20 1
a20 1
static char rcsid[] = "$Header: stdlib.c,v 1.1 88/05/20 16:34:06 ouster Exp $ SPRITE (Berkeley)";
d42 1
a42 1
    char buf[1000];
d60 31
d94 1
a94 1
    char buf[1000], c;
d96 1
d243 259
@
